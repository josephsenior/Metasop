{
  "step_id": "devops_infrastructure",
  "role": "DevOps",
  "timestamp": "2026-02-07T20:26:10.789Z",
  "content": {
    "summary": "A high-availability AWS infrastructure using EKS for container orchestration and RDS PostgreSQL, managed via Terraform to ensure sub-100ms latency and 99.9% uptime.",
    "description": "The infrastructure leverages AWS EKS to orchestrate the modular monolith, ensuring scalability for both the REST API and the WebSocket gateway. We utilize a Blue-Green deployment strategy via ArgoCD to minimize risk during updates. Data persistence is handled by Multi-AZ RDS PostgreSQL with strict security groups and IAM authentication. Redis ElastiCache is configured in Cluster Mode to handle high-throughput Pub/Sub events for the KDS. Observability is centralized in Datadog, monitoring business-critical metrics like 'Order-to-Kitchen' latency.",
    "infrastructure": {
      "cloud_provider": "AWS",
      "services": [
        {
          "name": "eks-cluster",
          "type": "compute",
          "configuration": {
            "version": "1.27",
            "node_group": "managed",
            "instance_types": "t3.medium, m5.large"
          },
          "description": "EKS cluster for container orchestration."
        },
        {
          "name": "primary-db",
          "type": "database",
          "configuration": {
            "engine": "postgres",
            "version": "15.4",
            "instance_class": "db.r6g.large",
            "storage": "gp3"
          },
          "description": "Multi-AZ RDS PostgreSQL for transactional data."
        },
        {
          "name": "redis-cache",
          "type": "storage",
          "configuration": {
            "engine": "redis",
            "cluster_mode": "enabled",
            "node_type": "cache.t4g.medium"
          },
          "description": "ElastiCache for Pub/Sub and session management."
        },
        {
          "name": "alb-ingress",
          "type": "load-balancer",
          "configuration": {
            "scheme": "internet-facing",
            "target_type": "ip",
            "stickiness": "enabled"
          },
          "description": "Application Load Balancer with WebSocket support."
        }
      ],
      "regions": [
        "us-east-1",
        "us-west-2"
      ],
      "iac": "Terraform"
    },
    "cicd": {
      "pipeline_stages": [
        {
          "name": "Build & Test",
          "steps": [
            "Checkout",
            "Install Deps",
            "Lint",
            "Unit Tests",
            "Build Docker Image"
          ],
          "goal": "Ensure code quality and create artifacts.",
          "status": "active"
        },
        {
          "name": "Security Scan",
          "steps": [
            "Container Scan (Trivy)",
            "SAST (SonarQube)",
            "Dependency Audit"
          ],
          "goal": "Detect vulnerabilities before deployment.",
          "status": "active"
        },
        {
          "name": "Deploy Staging",
          "steps": [
            "Terraform Plan",
            "Terraform Apply",
            "Helm Upgrade"
          ],
          "goal": "Deploy to pre-prod environment.",
          "status": "active"
        },
        {
          "name": "E2E Verification",
          "steps": [
            "Run Cypress Tests",
            "Load Test (k6)"
          ],
          "goal": "Validate functionality under load.",
          "status": "active"
        },
        {
          "name": "Deploy Prod",
          "steps": [
            "Manual Approval",
            "Canary Rollout",
            "Health Check"
          ],
          "goal": "Release to production users.",
          "status": "active"
        }
      ],
      "tools": [
        "GitHub Actions",
        "ArgoCD",
        "SonarQube"
      ],
      "triggers": [
        {
          "type": "push",
          "branch": "main",
          "description": "Triggers build and staging deploy."
        },
        {
          "type": "pull_request",
          "branch": "*",
          "description": "Triggers tests and linting."
        }
      ]
    },
    "containerization": {
      "docker_compose": "version: '3.8', services: { api: { build: '.', ports: ['3000:3000'] }, db: { image: 'postgres:15' } }",
      "dockerfile": "FROM node:18-alpine AS builder\nWORKDIR /app\nCOPY . .\nRUN npm ci && npm run build\nFROM node:18-alpine\nCOPY --from=builder /app/dist ./dist\nCMD [\"node\", \"dist/main\"]",
      "kubernetes": {
        "deployments": [
          {
            "name": "backend-api",
            "replicas": 3,
            "resources": {
              "cpu": "500m",
              "memory": "512Mi"
            }
          },
          {
            "name": "websocket-gateway",
            "replicas": 5,
            "resources": {
              "cpu": "1",
              "memory": "1Gi"
            }
          }
        ],
        "namespace": "restaurant-platform",
        "services": [
          {
            "name": "api-service",
            "ports": [
              {
                "port": 80,
                "targetPort": 3000
              }
            ],
            "type": "ClusterIP"
          },
          {
            "name": "ws-service",
            "ports": [
              {
                "port": 80,
                "targetPort": 8080
              }
            ],
            "type": "LoadBalancer"
          }
        ]
      }
    },
    "monitoring": {
      "tools": [
        "Datadog",
        "CloudWatch",
        "PagerDuty"
      ],
      "metrics": [
        {
          "name": "API Latency",
          "threshold": "100ms",
          "action": "Scale Out / Alert Warning"
        },
        {
          "name": "WebSocket Broadcast Lag",
          "threshold": "200ms",
          "action": "Alert Critical"
        },
        {
          "name": "Error Rate",
          "threshold": "1%",
          "action": "Trigger Rollback"
        }
      ],
      "alerts": [
        {
          "name": "High CPU Usage",
          "condition": "CPU > 80% for 5 minutes",
          "severity": "warning"
        },
        {
          "name": "Database Connections",
          "condition": "Connections > 80% of max",
          "severity": "critical"
        },
        {
          "name": "KDS Sync Failure",
          "condition": "Redis pub/sub latency > 500ms",
          "severity": "critical"
        }
      ],
      "logging": {
        "retention": "30d",
        "tools": [
          "Fluent Bit",
          "CloudWatch Logs",
          "Datadog Logs"
        ]
      }
    },
    "deployment": {
      "strategy": "blue-green",
      "environments": [
        {
          "name": "development",
          "configuration": {
            "replicas": "1",
            "resources": "small",
            "debug": "true"
          },
          "description": "Ephemeral environments for feature testing."
        },
        {
          "name": "staging",
          "configuration": {
            "replicas": "2",
            "resources": "medium",
            "db_anonymized": "true"
          },
          "description": "Pre-production environment mirroring prod config."
        },
        {
          "name": "production",
          "configuration": {
            "replicas": "auto",
            "resources": "large",
            "multi_az": "true"
          },
          "description": "High-availability environment for end users."
        }
      ],
      "rollback_strategy": "Automated rollback via ArgoCD if health probes fail or error rate exceeds 1% within 5 minutes of deployment."
    },
    "scaling": {
      "auto_scaling": {
        "enabled": true,
        "max_replicas": 50,
        "metrics": {
          "requests_per_second": 1000,
          "active_connections": 5000
        },
        "min_replicas": 3,
        "target_cpu": 70,
        "target_memory": 80,
        "triggers": [
          {
            "type": "cpu",
            "threshold": "70%",
            "metric": "CPU"
          },
          {
            "type": "custom",
            "threshold": "5000",
            "metric": "ActiveSockets"
          }
        ]
      },
      "manual_scaling": {
        "replicas": 3
      }
    },
    "disaster_recovery": {
      "rpo": "5 minutes",
      "rto": "1 hour",
      "backup_strategy": "Automated daily RDS snapshots retained for 35 days. Continuous WAL archiving to S3 for Point-in-Time Recovery (PITR). Cross-region snapshot replication to us-west-2.",
      "failover_plan": "Trigger DNS failover via Route53 to secondary region. Promote Read Replica in us-west-2 to Primary. Scale up standby EKS cluster using Terraform."
    }
  }
}