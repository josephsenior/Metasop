{
  "step_id": "devops_infrastructure",
  "role": "DevOps",
  "timestamp": "2026-02-07T21:45:43.386Z",
  "content": {
    "summary": "A high-availability AWS infrastructure using EKS for compute and RDS PostgreSQL for data, managed via Terraform. The strategy prioritizes real-time WebSocket performance and zero-downtime deployments using Blue/Green strategies.",
    "description": "We implement an immutable infrastructure approach using Terraform to provision a secure AWS environment. The core application runs on EKS with Horizontal Pod Autoscaling to handle lunch/dinner peaks. Data integrity is secured via Multi-AZ RDS PostgreSQL with strict encryption. The CI/CD pipeline leverages GitHub Actions for rigorous testing and security scanning before promoting artifacts to production. Observability is achieved through a combination of CloudWatch and Prometheus to ensure strict adherence to the <200ms API latency SLO.",
    "infrastructure": {
      "cloud_provider": "AWS",
      "services": [
        {
          "name": "eks-main",
          "type": "compute",
          "configuration": {
            "instance_type": "t3.medium",
            "node_count": "3",
            "version": "1.27"
          },
          "description": "Managed Kubernetes cluster for application workloads."
        },
        {
          "name": "rds-postgres",
          "type": "database",
          "configuration": {
            "engine": "postgres",
            "version": "15.3",
            "instance_class": "db.t3.medium",
            "storage": "100GB"
          },
          "description": "Primary relational database with Multi-AZ for high availability."
        },
        {
          "name": "elasticache-redis",
          "type": "storage",
          "configuration": {
            "engine": "redis",
            "node_type": "cache.t3.micro",
            "num_cache_nodes": "2"
          },
          "description": "Redis cluster for WebSocket pub/sub and caching."
        },
        {
          "name": "alb-ingress",
          "type": "load-balancer",
          "configuration": {
            "scheme": "internet-facing",
            "listener_port": "443",
            "ssl_policy": "ELBSecurityPolicy-2016-08"
          },
          "description": "Application Load Balancer handling TLS termination and routing."
        },
        {
          "name": "cloudfront-cdn",
          "type": "cdn",
          "configuration": {
            "price_class": "PriceClass_100",
            "origin": "s3-bucket"
          },
          "description": "CDN for caching static frontend assets."
        },
        {
          "name": "cloudwatch",
          "type": "monitoring",
          "configuration": {
            "retention": "30",
            "log_group_class": "STANDARD"
          },
          "description": "Centralized logging and metrics collection."
        }
      ],
      "regions": [
        "us-east-1"
      ],
      "iac": "Terraform"
    },
    "cicd": {
      "pipeline_stages": [
        {
          "name": "Build",
          "steps": [
            "Checkout Code",
            "Install Dependencies",
            "Lint",
            "Build Docker Image"
          ],
          "goal": "Compile code and create container artifacts.",
          "status": "active"
        },
        {
          "name": "Test",
          "steps": [
            "Unit Tests",
            "Integration Tests",
            "Upload Coverage"
          ],
          "goal": "Ensure code reliability and functionality.",
          "status": "active"
        },
        {
          "name": "Security",
          "steps": [
            "SAST Scan",
            "Container Vulnerability Scan",
            "Secret Detection"
          ],
          "goal": "Identify security vulnerabilities before deployment.",
          "status": "active"
        },
        {
          "name": "Deploy Staging",
          "steps": [
            "Terraform Apply",
            "Helm Upgrade",
            "Verify Health"
          ],
          "goal": "Deploy to pre-production environment for validation.",
          "status": "active"
        },
        {
          "name": "Deploy Prod",
          "steps": [
            "Manual Approval",
            "Helm Upgrade Blue/Green",
            "Smoke Test"
          ],
          "goal": "Release to production with zero downtime.",
          "status": "active"
        }
      ],
      "tools": [
        "GitHub Actions"
      ],
      "triggers": [
        {
          "type": "push",
          "branch": "main",
          "description": "Triggers build and deploy to staging."
        },
        {
          "type": "pull_request",
          "branch": "main",
          "description": "Triggers build and test stages."
        }
      ]
    },
    "containerization": {
      "docker_compose": "version: '3.8', services: { api: { build: '.', ports: ['3000:3000'] }, db: { image: 'postgres:15' } }",
      "dockerfile": "FROM node:18-alpine AS builder\nWORKDIR /app\nCOPY . .\nRUN npm ci && npm run build\nFROM node:18-alpine\nCOPY --from=builder /app/dist ./dist\nCMD [\"node\", \"dist/main\"]",
      "kubernetes": {
        "deployments": [
          {
            "name": "pos-backend",
            "replicas": 3,
            "resources": {
              "cpu": "500m",
              "memory": "1Gi"
            }
          },
          {
            "name": "pos-websocket-service",
            "replicas": 2,
            "resources": {
              "cpu": "500m",
              "memory": "1Gi"
            }
          }
        ],
        "namespace": "pos-production",
        "services": [
          {
            "name": "backend-svc",
            "ports": [
              {
                "port": 80,
                "targetPort": 3000
              }
            ],
            "type": "ClusterIP"
          },
          {
            "name": "ingress-gateway",
            "ports": [
              {
                "port": 443,
                "targetPort": 80
              }
            ],
            "type": "LoadBalancer"
          }
        ]
      }
    },
    "monitoring": {
      "tools": [
        "CloudWatch",
        "Prometheus",
        "Grafana"
      ],
      "metrics": [
        {
          "name": "API Latency",
          "threshold": "200ms",
          "action": "Trigger Warning Alert"
        },
        {
          "name": "WebSocket Broadcast Latency",
          "threshold": "50ms",
          "action": "Trigger Critical Alert"
        },
        {
          "name": "Error Rate",
          "threshold": "1%",
          "action": "Trigger Critical Alert"
        }
      ],
      "alerts": [
        {
          "name": "High CPU Usage",
          "condition": "CPU > 80% for 5 minutes",
          "severity": "warning"
        },
        {
          "name": "Database Connection Spike",
          "condition": "Connections > 80% of max",
          "severity": "critical"
        },
        {
          "name": "Pod CrashLoopBackOff",
          "condition": "Pod restarts > 5 in 10 minutes",
          "severity": "critical"
        }
      ],
      "logging": {
        "retention": "30d",
        "tools": [
          "CloudWatch Logs",
          "Fluent Bit"
        ]
      }
    },
    "deployment": {
      "strategy": "blue-green",
      "environments": [
        {
          "name": "development",
          "configuration": {
            "replicas": "1",
            "cpu_limit": "250m",
            "memory_limit": "512Mi",
            "db_instance": "db.t3.micro"
          },
          "description": "Sandbox environment for individual developer testing."
        },
        {
          "name": "staging",
          "configuration": {
            "replicas": "2",
            "cpu_limit": "500m",
            "memory_limit": "1Gi",
            "db_instance": "db.t3.small"
          },
          "description": "Pre-production environment mirroring production config."
        },
        {
          "name": "production",
          "configuration": {
            "replicas": "3",
            "cpu_limit": "1000m",
            "memory_limit": "2Gi",
            "db_instance": "db.t3.medium"
          },
          "description": "High-availability environment for end users."
        }
      ],
      "rollback_strategy": "Automated rollback via Helm if health checks fail within 5 minutes of deployment."
    },
    "scaling": {
      "auto_scaling": {
        "enabled": true,
        "max_replicas": 10,
        "metrics": {
          "requests_per_second": 1000
        },
        "min_replicas": 2,
        "target_cpu": 70,
        "target_memory": 80,
        "triggers": [
          {
            "type": "cpu",
            "threshold": "70",
            "metric": "CPU"
          },
          {
            "type": "memory",
            "threshold": "80",
            "metric": "Memory"
          }
        ]
      },
      "manual_scaling": {
        "replicas": 3
      }
    },
    "disaster_recovery": {
      "rpo": "5 minutes (Point-in-Time Recovery)",
      "rto": "1 hour",
      "backup_strategy": "Daily automated RDS snapshots retained for 30 days; Transaction logs backed up every 5 minutes to S3; Terraform state versioned in S3.",
      "failover_plan": "Automated DNS failover via Route53 to standby region DR cluster; Read replicas promoted to primary if main DB fails."
    }
  }
}