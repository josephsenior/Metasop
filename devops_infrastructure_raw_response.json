{
  "step_id": "devops_infrastructure",
  "role": "DevOps",
  "content": {
    "infrastructure": {
      "cloud_provider": "AWS",
      "services": [
        {
          "name": "Amazon ECS (Fargate)",
          "type": "compute",
          "configuration": {
            "key": "launch_type",
            "value": "FARGATE"
          },
          "description": "Serverless container compute for API and Market Data Engine services to ensure scalability without managing instances."
        },
        {
          "name": "Amazon RDS for PostgreSQL",
          "type": "database",
          "configuration": {
            "key": "engine_version",
            "value": "15.x"
          },
          "description": "Managed relational database with Multi-AZ deployment for high availability of user data and trade history."
        },
        {
          "name": "Amazon ElastiCache (Redis)",
          "type": "database",
          "configuration": {
            "key": "cluster_mode",
            "value": "enabled"
          },
          "description": "In-memory data store for real-time market data Pub/Sub, WebSocket session management, and rate-limit semaphores."
        },
        {
          "name": "AWS KMS",
          "type": "security",
          "configuration": {
            "key": "algorithm",
            "value": "SYMMETRIC_DEFAULT"
          },
          "description": "Key Management Service for envelope encryption of user API secrets (AES-256-GCM)."
        },
        {
          "name": "Application Load Balancer",
          "type": "load-balancer",
          "configuration": {
            "key": "scheme",
            "value": "internet-facing"
          },
          "description": "Layer 7 load balancer handling WebSocket upgrades (WSS) and HTTPS traffic distribution."
        },
        {
          "name": "AWS WAF",
          "type": "security",
          "configuration": {
            "key": "rule_set",
            "value": "AWSManagedRulesCommonRuleSet"
          },
          "description": "Web Application Firewall to protect against SQL injection, XSS, and DDoS attacks."
        },
        {
          "name": "NAT Gateway",
          "type": "networking",
          "configuration": {
            "key": "redundancy",
            "value": "multi-az"
          },
          "description": "Allows private subnet resources (ECS, RDS) to access external Exchange APIs securely."
        }
      ],
      "iac": "Terraform",
      "regions": [
        "us-east-1",
        "eu-central-1"
      ]
    },
    "cicd": {
      "pipeline_stages": [
        {
          "name": "Continuous Integration",
          "steps": [
            "Checkout Code",
            "Install Dependencies",
            "Linting (ESLint)",
            "Unit Tests (Jest)",
            "SAST Scan (SonarQube)",
            "Secret Scanning (TruffleHog)"
          ],
          "description": "Code quality and security verification.",
          "status": "active"
        },
        {
          "name": "Build & Publish",
          "steps": [
            "Build Docker Image",
            "Container Image Scan (Trivy)",
            "Push to Amazon ECR",
            "Tag with Commit SHA"
          ],
          "description": "Artifact creation and registry push.",
          "status": "active"
        },
        {
          "name": "Deploy to Staging",
          "steps": [
            "Update ECS Task Definition",
            "Terraform Apply (Staging)",
            "Run Database Migrations",
            "Integration Tests (Cypress/Supertest)"
          ],
          "description": "Deployment to pre-production environment.",
          "status": "active"
        },
        {
          "name": "Production Release",
          "steps": [
            "Manual Approval Gate",
            "Terraform Apply (Production)",
            "Blue/Green Deployment Trigger",
            "Health Check Verification",
            "Traffic Switch"
          ],
          "description": "Zero-downtime production deployment.",
          "status": "active"
        }
      ],
      "tools": [
        "GitHub Actions",
        "Terraform Cloud",
        "SonarQube",
        "Amazon ECR"
      ],
      "triggers": [
        {
          "type": "push",
          "branch": "main",
          "description": "Triggers CI and Staging deploy"
        },
        {
          "type": "pull_request",
          "branch": "*",
          "description": "Triggers CI and Test builds"
        }
      ]
    },
    "deployment": {
      "strategy": "blue-green",
      "environments": [
        {
          "name": "development",
          "configuration": {
            "key": "debug_mode",
            "value": "true"
          },
          "description": "Ephemeral environments for feature branches."
        },
        {
          "name": "staging",
          "configuration": {
            "key": "replica_count",
            "value": "2"
          },
          "description": "Mirror of production for UAT and load testing."
        },
        {
          "name": "production",
          "configuration": {
            "key": "multi_az",
            "value": "true"
          },
          "description": "High-availability environment with strict security controls."
        }
      ],
      "rollback_strategy": "Automated rollback via AWS CodeDeploy if health checks fail during the traffic shifting phase (10% -> 100%)."
    },
    "monitoring": {
      "tools": [
        "Datadog",
        "AWS CloudWatch",
        "PagerDuty"
      ],
      "metrics": [
        "WebSocket Active Connections",
        "Exchange API Latency (p95, p99)",
        "Order Execution Time (Internal + External)",
        "Redis CPU Utilization",
        "ECS Task CPU/Memory",
        "Rate Limit Consumption (per Exchange)"
      ],
      "alerts": [
        {
          "name": "High Exchange Latency",
          "condition": "avg(exchange_latency) > 500ms for 2m",
          "severity": "warning"
        },
        {
          "name": "Order Execution Failure Spike",
          "condition": "sum(failed_orders) > 5 in 1m",
          "severity": "critical"
        },
        {
          "name": "Redis Memory Critical",
          "condition": "redis_memory_usage > 85%",
          "severity": "critical"
        }
      ],
      "logging": {
        "retention": "90 days",
        "tools": [
          "AWS CloudWatch Logs",
          "Datadog Log Management"
        ]
      }
    },
    "containerization": {
      "docker_compose": "version: '3.8'",
      "dockerfile": "Multi-stage build: Base (Node 18 Alpine) -> Builder (Install deps & build) -> Runner (Production deps only)",
      "kubernetes": {
        "deployments": [
          {
            "name": "api-gateway",
            "replicas": 3,
            "resources": {
              "cpu": "1024",
              "memory": "2048Mi"
            }
          },
          {
            "name": "market-data-engine",
            "replicas": 2,
            "resources": {
              "cpu": "2048",
              "memory": "4096Mi"
            }
          }
        ],
        "namespace": "cryptopulse-prod",
        "services": [
          {
            "name": "api-service",
            "ports": [
              {
                "port": 80,
                "targetPort": 3000
              }
            ],
            "type": "LoadBalancer"
          }
        ]
      }
    },
    "scaling": {
      "auto_scaling": {
        "enabled": true,
        "max_replicas": 20,
        "min_replicas": 3,
        "target_cpu": 60,
        "target_memory": 70
      },
      "manual_scaling": {
        "replicas": 1
      }
    },
    "disaster_recovery": {
      "rpo": "5 minutes",
      "rto": "1 hour",
      "backup_strategy": "Automated daily RDS snapshots with 35-day retention. Cross-region snapshot replication to eu-central-1 for catastrophe recovery. Point-in-time recovery (PITR) enabled.",
      "failover_plan": "DNS failover via Route53 to secondary region. Read replicas promoted to primary. Redis cache is rebuilt from cold start (acceptable performance degradation)."
    },
    "summary": "Enterprise-grade AWS infrastructure leveraging ECS Fargate for compute and RDS/ElastiCache for state. Designed for high availability and security compliance.",
    "description": "The infrastructure is designed to support a high-frequency trading terminal. It prioritizes security (private subnets, KMS), low latency (Redis, ALB WebSocket support), and reliability (Multi-AZ RDS, Blue/Green deployments). Terraform manages the entire stack to ensure reproducibility.",
    "cloud_provider": "AWS",
    "infra_components": 7
  }
}