{
  "step_id": "engineer_impl",
  "role": "Engineer",
  "content": {
    "summary": "EduPulse is a high-performance, AI-enhanced e-learning platform designed to provide a seamless educational experience for both learners and instructors.",
    "description": "The platform utilizes a microservices architecture to ensure maximum scalability and reliability. It features an AI recommendation engine, a robust video delivery network using HLS, and a comprehensive analytics suite. Built with NestJS, Next.js, and FastAPI, it is designed to handle 50,000+ concurrent users.",
    "artifact_path": "edupulse-monorepo",
    "file_structure": {
      "name": "edupulse",
      "type": "directory",
      "children": [
        {
          "name": "apps",
          "type": "directory"
        },
        {
          "name": "services",
          "type": "directory"
        },
        {
          "name": "libs",
          "type": "directory"
        },
        {
          "name": "infra",
          "type": "directory"
        }
      ]
    },
    "implementation_plan": "# EduPulse Technical Implementation Roadmap\n\n## Phase 1: Foundation & Identity (Weeks 1-3)\n- **Monorepo Setup**: Initialize Turborepo with NestJS (Backend), Next.js (Frontend), and shared TypeScript configurations.\n- **Identity Provider**: Integrate Auth0 for OIDC/OAuth2. Implement custom login/signup flows with social providers (Google, LinkedIn).\n- **API Gateway**: Deploy a NestJS-based Gateway using `@nestjs/terminus` for health checks and `express-gateway` or custom proxy logic for routing.\n\n## Phase 2: Course Management & Content (Weeks 4-6)\n- **Course Service**: Develop the core CRUD service using NestJS and Prisma ORM. Implement the 'Instructor Dashboard' for curriculum creation.\n- **Database Design**: Set up PostgreSQL with Row Level Security (RLS) to isolate instructor data.\n- **Search Indexing**: Implement a 'Sync Worker' that listens to PostgreSQL changes and updates the Elasticsearch index for real-time discovery.\n\n## Phase 3: Video Engineering Pipeline (Weeks 7-10)\n- **Ingestion**: Create an S3-based upload system with pre-signed URLs for instructors.\n- **Transcoding**: Configure AWS Elemental MediaConvert to trigger on S3 'ObjectCreated' events, generating HLS manifests and multi-bitrate TS files.\n- **Delivery**: Set up CloudFront with Signed Cookies/URLs to protect premium content.\n- **Player Interface**: Build a custom Video.js wrapper in Next.js with HLS support and timestamped note-taking capabilities.\n\n## Phase 4: Commerce & Progress (Weeks 11-13)\n- **Payment Service**: Integrate Stripe Checkout and Webhooks. Implement a 'Purchase' flow that grants course access upon successful payment.\n- **Progress Tracking**: Develop a high-frequency 'Heartbeat' API in Go to handle concurrent progress updates from thousands of active learners.\n- **Analytics**: Aggregate progress data into a 'Student Analytics' dashboard for instructors.\n\n## Phase 5: AI Personalization & Optimization (Weeks 14-16)\n- **AI Service**: Deploy a FastAPI service to process user activity logs. Use a vector database (Pinecone or pgvector) for similarity searches.\n- **Recommendation Engine**: Implement a collaborative filtering model to generate 'Recommended for You' sections.\n- **Performance Tuning**: Optimize Next.js with ISR (Incremental Static Regeneration) for course landing pages and implement Redis caching for API responses.",
    "dependencies": [
      "@nestjs/core@^10.0.0",
      "@nestjs/prisma@^0.23.0",
      "next@^14.0.0",
      "zustand@^4.4.0",
      "@tanstack/react-query@^5.0.0",
      "stripe@^14.0.0",
      "auth0-js@^9.23.0",
      "video.js@^8.5.0",
      "elasticsearch@^8.10.0",
      "fastapi@^0.104.0",
      "prisma@^5.5.0",
      "tailwindcss@^3.3.0",
      "typescript@^5.2.0"
    ],
    "technical_decisions": [
      {
        "decision": "Turborepo Monorepo",
        "rationale": "Enables shared types and components between the web client and multiple microservices while maintaining independent deployment cycles.",
        "alternatives": "Polyrepo (too much overhead for shared types)"
      },
      {
        "decision": "Zustand + TanStack Query",
        "rationale": "Zustand handles lightweight UI state (sidebar, video player controls), while TanStack Query manages complex server-state caching and synchronization.",
        "alternatives": "Redux Toolkit (too boilerplate-heavy)"
      },
      {
        "decision": "HLS over MP4",
        "rationale": "Required for adaptive bitrate streaming to satisfy the 'Streaming Reliability' criteria on mobile/4G connections.",
        "alternatives": "Progressive MP4 (poor performance on slow networks)"
      },
      {
        "decision": "CQRS with Elasticsearch",
        "rationale": "Decouples heavy search queries from the primary transactional database, ensuring <500ms search latency.",
        "alternatives": "PostgreSQL Full-Text Search (doesn't scale as well for complex filters)"
      }
    ],
    "environment_variables": [
      {
        "name": "DATABASE_URL",
        "description": "PostgreSQL connection string for the Course Service.",
        "example": "postgresql://user:password@localhost:5432/edupulse"
      },
      {
        "name": "AUTH0_DOMAIN",
        "description": "The domain of the Auth0 tenant for authentication.",
        "example": "edupulse-prod.auth0.com"
      },
      {
        "name": "STRIPE_SECRET_KEY",
        "description": "Secret key for processing payments via Stripe API.",
        "example": "sk_test_51..."
      },
      {
        "name": "AWS_MEDIA_CONVERT_ENDPOINT",
        "description": "Regional endpoint for AWS Elemental MediaConvert.",
        "example": "https://abc123xyz.mediaconvert.us-east-1.amazonaws.com"
      }
    ],
    "technical_patterns": [
      "Microservices",
      "Event-Driven Architecture",
      "CQRS",
      "BFF (Backend for Frontend)",
      "Repository Pattern",
      "Dependency Injection"
    ],
    "state_management": {
      "tool": "Zustand & TanStack Query",
      "strategy": "Slice pattern for UI state (Zustand) and Cache-first hydration for server data (TanStack Query)."
    },
    "run_results": {
      "setup_commands": [
        "npm install",
        "npx prisma generate --schema=./services/course-service/prisma/schema.prisma",
        "docker-compose up -d postgres redis elasticsearch"
      ],
      "test_commands": [
        "npm run test",
        "npm run test:e2e"
      ],
      "dev_commands": [
        "npm run dev",
        "cd services/ai-service && uvicorn main:app --reload"
      ]
    }
  }
}