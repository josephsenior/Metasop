{
  "step_id": "devops_infrastructure",
  "role": "DevOps",
  "timestamp": "2026-01-20T09:03:09.544Z",
  "content": {
    "summary": "Cloud-native AWS architecture using EKS and Terraform, featuring canary deployments and auto-scaling to support high-throughput social feeds.",
    "description": "We utilize a GitOps approach with Terraform and ArgoCD to manage a scalable Kubernetes (EKS) infrastructure. The system leverages managed services (RDS, ElastiCache) for data persistence to reduce operational overhead. Observability is centralized via Prometheus/ELK, ensuring strict SLO adherence for the real-time feed and messaging components.",
    "cloud_provider": "AWS",
    "infra_components": 12,
    "infrastructure": {
      "cloud_provider": "AWS",
      "services": [
        {
          "name": "eks-cluster-prod",
          "type": "compute",
          "configuration": {
            "version": "1.27",
            "node_groups": [
              {
                "instance_types": [
                  "t3.medium",
                  "m5.large"
                ],
                "scaling_config": {
                  "min_size": 3,
                  "max_size": 10
                }
              }
            ]
          },
          "description": "Managed Kubernetes cluster for application workloads."
        },
        {
          "name": "rds-postgres-prod",
          "type": "database",
          "configuration": {
            "engine": "postgres",
            "engine_version": "15.3",
            "instance_class": "db.r6g.xlarge",
            "multi_az": true,
            "storage_encrypted": true
          },
          "description": "Primary relational database for user data and posts."
        },
        {
          "name": "elasticache-redis-prod",
          "type": "database",
          "configuration": {
            "engine": "redis",
            "cache_node_type": "cache.m6g.large",
            "num_cache_nodes": 2,
            "automatic_failover_enabled": true
          },
          "description": "In-memory store for feeds, sessions, and Pub/Sub."
        },
        {
          "name": "s3-media-storage",
          "type": "storage",
          "configuration": {
            "bucket_name": "social-platform-media-prod",
            "versioning": "Enabled",
            "cors_rules": [
              {
                "allowed_methods": [
                  "PUT",
                  "GET"
                ]
              }
            ]
          },
          "description": "Object storage for user-uploaded images and videos."
        },
        {
          "name": "cloudfront-cdn",
          "type": "cdn",
          "configuration": {
            "price_class": "PriceClass_100",
            "enabled": true,
            "origins": [
              {
                "domain_name": "s3-media-storage"
              }
            ]
          },
          "description": "Content Delivery Network for static assets and media."
        },
        {
          "name": "alb-ingress",
          "type": "load-balancer",
          "configuration": {
            "scheme": "internet-facing",
            "ip_address_type": "ipv4",
            "target_type": "ip"
          },
          "description": "Application Load Balancer for traffic distribution."
        }
      ],
      "iac": "Terraform",
      "regions": [
        "us-east-1",
        "eu-central-1"
      ]
    },
    "cicd": {
      "pipeline_stages": [
        {
          "name": "Lint & Test",
          "steps": [
            "npm install",
            "npm run lint",
            "npm run test:unit"
          ],
          "goal": "Ensure code quality and functionality before build."
        },
        {
          "name": "Security Scan",
          "steps": [
            "snyk test",
            "trivy image scan"
          ],
          "goal": "Detect vulnerabilities in dependencies and container images."
        },
        {
          "name": "Build & Push",
          "steps": [
            "docker build -t social-api:${GITHUB_SHA}",
            "aws ecr get-login-password",
            "docker push social-api:${GITHUB_SHA}"
          ],
          "goal": "Package application into immutable container artifacts."
        },
        {
          "name": "Deploy Staging",
          "steps": [
            "helm upgrade --install social-api ./charts --namespace staging"
          ],
          "goal": "Deploy to pre-production environment for integration testing."
        },
        {
          "name": "Deploy Production",
          "steps": [
            "helm upgrade --install social-api ./charts --namespace prod --set image.tag=${GITHUB_SHA}"
          ],
          "goal": "Rollout to production using defined strategy."
        }
      ],
      "tools": [
        "GitHub Actions",
        "ArgoCD",
        "Helm",
        "SonarQube"
      ],
      "triggers": [
        {
          "type": "push",
          "branch": "main",
          "description": "Triggers build and deploy to staging."
        },
        {
          "type": "pull_request",
          "branch": "main",
          "description": "Triggers lint, test, and security scan."
        },
        {
          "type": "manual",
          "description": "Production promotion trigger."
        }
      ]
    },
    "containerization": {
      "docker_compose": "version: '3.8'\nservices:\n  api:\n    build: .\n    ports: ['4000:4000']\n    environment:\n      - NODE_ENV=development\n      - DATABASE_URL=postgres://user:pass@db:5432/social\n  db:\n    image: postgres:15\n  redis:\n    image: redis:7",
      "dockerfile": "FROM node:18-alpine AS builder\nWORKDIR /app\nCOPY package*.json ./\nRUN npm ci\nCOPY . .\nRUN npm run build\n\nFROM node:18-alpine\nWORKDIR /app\nCOPY --from=builder /app/dist ./dist\nCOPY --from=builder /app/node_modules ./node_modules\nCMD [\"node\", \"dist/index.js\"]",
      "kubernetes": {
        "deployments": [
          {
            "name": "social-api",
            "replicas": 3,
            "resources": {
              "cpu": "500m",
              "memory": "512Mi"
            }
          },
          {
            "name": "feed-worker",
            "replicas": 2,
            "resources": {
              "cpu": "250m",
              "memory": "256Mi"
            }
          }
        ],
        "namespace": "social-platform",
        "services": [
          {
            "name": "social-api-svc",
            "ports": [
              {
                "port": 80,
                "targetPort": 4000
              }
            ],
            "type": "ClusterIP"
          }
        ]
      }
    },
    "monitoring": {
      "tools": [
        "Prometheus",
        "Grafana",
        "ELK Stack",
        "PagerDuty"
      ],
      "metrics": [
        {
          "name": "API Latency",
          "threshold": "200ms",
          "action": "Scale out or Alert Warning"
        },
        {
          "name": "Error Rate (5xx)",
          "threshold": "1%",
          "action": "Alert Critical and Rollback"
        },
        {
          "name": "CPU Saturation",
          "threshold": "75%",
          "action": "Trigger HPA"
        }
      ],
      "alerts": [
        {
          "name": "HighErrorRate",
          "condition": "rate(http_requests_total{status=~\"5..\"}[5m]) > 1%",
          "severity": "critical"
        },
        {
          "name": "HighLatency",
          "condition": "histogram_quantile(0.95, rate(http_request_duration_seconds_bucket[5m])) > 0.2",
          "severity": "warning"
        },
        {
          "name": "DatabaseCPUHigh",
          "condition": "avg(rds_cpu_utilization) > 85%",
          "severity": "critical"
        }
      ],
      "logging": {
        "retention": "30d",
        "tools": [
          "Fluentd",
          "Elasticsearch",
          "Kibana"
        ]
      }
    },
    "deployment": {
      "strategy": "canary",
      "environments": [
        {
          "name": "development",
          "configuration": {
            "key": "replicas",
            "value": "1"
          },
          "description": "Ephemeral environments for feature branches."
        },
        {
          "name": "staging",
          "configuration": {
            "key": "replicas",
            "value": "2"
          },
          "description": "Pre-production environment with data parity."
        },
        {
          "name": "production",
          "configuration": {
            "key": "replicas",
            "value": "auto"
          },
          "description": "High-availability environment for end users."
        }
      ],
      "rollback_strategy": "Automated rollback via ArgoCD if health checks fail within 5 minutes of deployment."
    },
    "scaling": {
      "auto_scaling": {
        "enabled": true,
        "max_replicas": 50,
        "metrics": {
          "requests_per_second": 1000,
          "active_socket_connections": 5000
        },
        "min_replicas": 3,
        "target_cpu": 70,
        "target_memory": 80,
        "triggers": [
          {
            "type": "cpu",
            "threshold": "70%"
          },
          {
            "type": "memory",
            "threshold": "80%"
          }
        ]
      },
      "manual_scaling": {
        "replicas": 3
      }
    },
    "disaster_recovery": {
      "rpo": "15 minutes",
      "rto": "4 hours",
      "backup_strategy": "Daily automated snapshots of RDS and ElastiCache with 35-day retention. S3 Cross-Region Replication enabled for media assets.",
      "failover_plan": "Automated DNS failover via Route53 to secondary region. Terraform scripts to hydrate stateless compute in DR region."
    }
  }
}