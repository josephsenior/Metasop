{
  "step_id": "devops_infrastructure",
  "role": "DevOps",
  "timestamp": "2026-01-20T01:36:25.453Z",
  "content": {
    "summary": "Cloud-native AWS architecture utilizing EKS for orchestration, RDS for data persistence, and Terraform for IaC to ensure a scalable, secure, and high-performance blog platform.",
    "description": "We implement a robust DevSecOps strategy centered on AWS EKS to manage the Next.js and Node.js microservices. Infrastructure is fully defined in Terraform for reproducibility. We utilize a rolling deployment strategy to ensure zero downtime. Observability is handled via Prometheus/Grafana, and security is enforced through strict IAM policies and network segmentation. Data integrity is guaranteed via multi-AZ RDS deployments and cross-region S3 replication.",
    "cloud_provider": "AWS",
    "infra_components": 5,
    "infrastructure": {
      "cloud_provider": "AWS",
      "services": [
        {
          "name": "prod-db",
          "type": "database",
          "configuration": {
            "engine": "postgres",
            "version": "15.4",
            "instance_class": "db.t3.medium",
            "storage": "100GB",
            "multi_az": true
          },
          "description": "Primary PostgreSQL database for content and user data."
        },
        {
          "name": "app-cluster",
          "type": "compute",
          "configuration": {
            "platform": "EKS",
            "version": "1.28",
            "node_group": "managed",
            "instance_types": [
              "t3.medium"
            ],
            "min_size": 2,
            "max_size": 10
          },
          "description": "Kubernetes cluster hosting Next.js frontend and Node.js backend."
        },
        {
          "name": "asset-store",
          "type": "storage",
          "configuration": {
            "bucket_name": "blog-assets-prod",
            "encryption": "AES256",
            "versioning": "enabled",
            "lifecycle_rule": "glacier-transition-90d"
          },
          "description": "S3 bucket for storing uploaded images and static assets."
        },
        {
          "name": "global-cdn",
          "type": "cdn",
          "configuration": {
            "price_class": "PriceClass_100",
            "ssl_support": "sni-only",
            "origin_protocol_policy": "https-only"
          },
          "description": "CloudFront distribution for caching static assets and ISR pages."
        },
        {
          "name": "cache-layer",
          "type": "storage",
          "configuration": {
            "engine": "redis",
            "node_type": "cache.t3.micro",
            "num_cache_nodes": 1
          },
          "description": "ElastiCache Redis for API response caching and session management."
        }
      ],
      "iac": "Terraform",
      "regions": [
        "us-east-1",
        "eu-central-1"
      ]
    },
    "cicd": {
      "pipeline_stages": [
        {
          "name": "Lint & Test",
          "steps": [
            "npm install",
            "npm run lint",
            "npm run test:unit"
          ],
          "goal": "Ensure code quality and pass unit tests."
        },
        {
          "name": "Build & Push",
          "steps": [
            "docker build -t frontend .",
            "docker build -t backend .",
            "aws ecr push"
          ],
          "goal": "Containerize applications and store in registry."
        },
        {
          "name": "Deploy Staging",
          "steps": [
            "helm upgrade --install blog-staging ./charts",
            "npm run test:e2e"
          ],
          "goal": "Deploy to staging environment and run integration tests."
        },
        {
          "name": "Deploy Prod",
          "steps": [
            "helm upgrade --install blog-prod ./charts",
            "aws cloudfront create-invalidation"
          ],
          "goal": "Promote verified artifacts to production."
        }
      ],
      "tools": [
        "GitHub Actions",
        "Docker",
        "Helm",
        "SonarQube"
      ],
      "triggers": [
        {
          "type": "push",
          "branch": "main",
          "description": "Triggers staging deployment."
        },
        {
          "type": "pull_request",
          "branch": "main",
          "description": "Triggers linting and unit tests."
        },
        {
          "type": "manual",
          "description": "Triggers production promotion."
        }
      ]
    },
    "containerization": {
      "docker_compose": "version: '3.8'\nservices:\n  db:\n    image: postgres:15\n  api:\n    build: ./backend\n  web:\n    build: ./frontend",
      "dockerfile": "FROM node:18-alpine AS builder\nWORKDIR /app\nCOPY . .\nRUN npm ci && npm run build\nFROM node:18-alpine AS runner\nCOPY --from=builder /app/.next ./.next\nCMD [\"npm\", \"start\"]",
      "kubernetes": {
        "deployments": [
          {
            "name": "nextjs-frontend",
            "replicas": 3,
            "resources": {
              "cpu": "500m",
              "memory": "512Mi"
            }
          },
          {
            "name": "nodejs-api",
            "replicas": 2,
            "resources": {
              "cpu": "250m",
              "memory": "256Mi"
            }
          }
        ],
        "namespace": "blog-platform",
        "services": [
          {
            "name": "frontend-svc",
            "ports": [
              {
                "port": 80,
                "targetPort": 3000
              }
            ],
            "type": "LoadBalancer"
          },
          {
            "name": "api-svc",
            "ports": [
              {
                "port": 80,
                "targetPort": 4000
              }
            ],
            "type": "ClusterIP"
          }
        ]
      }
    },
    "monitoring": {
      "tools": [
        "Prometheus",
        "Grafana",
        "CloudWatch",
        "Sentry"
      ],
      "metrics": [
        {
          "name": "http_request_duration_seconds",
          "threshold": "p95 > 0.5s",
          "action": "Scale up replicas"
        },
        {
          "name": "container_cpu_usage",
          "threshold": "> 80%",
          "action": "Trigger HPA"
        },
        {
          "name": "error_rate_5xx",
          "threshold": "> 1%",
          "action": "Alert On-Call"
        }
      ],
      "alerts": [
        {
          "name": "HighErrorRate",
          "condition": "rate(http_requests_total{status=~\"5..\"}[5m]) > 0.01",
          "severity": "critical"
        },
        {
          "name": "HighLatency",
          "condition": "histogram_quantile(0.95, rate(http_request_duration_seconds_bucket[5m])) > 1.0",
          "severity": "warning"
        },
        {
          "name": "LowDiskSpace",
          "condition": "node_filesystem_avail_bytes / node_filesystem_size_bytes < 0.15",
          "severity": "warning"
        }
      ],
      "logging": {
        "retention": "30d",
        "tools": [
          "Fluentd",
          "Elasticsearch",
          "Kibana"
        ]
      }
    },
    "deployment": {
      "strategy": "rolling",
      "environments": [
        {
          "name": "development",
          "configuration": {
            "key": "NODE_ENV",
            "value": "development"
          },
          "description": "Local or ephemeral environment for feature development."
        },
        {
          "name": "staging",
          "configuration": {
            "key": "NODE_ENV",
            "value": "staging"
          },
          "description": "Pre-production environment mirroring prod config."
        },
        {
          "name": "production",
          "configuration": {
            "key": "NODE_ENV",
            "value": "production"
          },
          "description": "Live environment serving real user traffic."
        }
      ],
      "rollback_strategy": "Automated rollback via Helm if health checks fail within 5 minutes of deployment."
    },
    "scaling": {
      "auto_scaling": {
        "enabled": true,
        "max_replicas": 10,
        "metrics": {
          "type": "Resource",
          "resource": {
            "name": "cpu",
            "target": {
              "type": "Utilization",
              "averageUtilization": 70
            }
          }
        },
        "min_replicas": 2,
        "target_cpu": 70,
        "target_memory": 80,
        "triggers": [
          {
            "type": "cpu",
            "threshold": "70%"
          },
          {
            "type": "memory",
            "threshold": "80%"
          }
        ]
      },
      "manual_scaling": {
        "replicas": 2
      }
    },
    "disaster_recovery": {
      "rpo": "15 minutes",
      "rto": "2 hours",
      "backup_strategy": "Daily automated snapshots of RDS with 7-day retention. WAL logs archived to S3 every 5 minutes for Point-in-Time Recovery. S3 assets replicated to a secondary region.",
      "failover_plan": "Manual promotion of Read Replica in secondary region to Primary. DNS failover via Route53 to secondary region Load Balancer."
    }
  }
}